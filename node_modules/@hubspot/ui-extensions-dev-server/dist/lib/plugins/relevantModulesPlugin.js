"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getRelevantModules = void 0;
const utils_1 = require("../utils");
// @ts-expect-error no type defs for the logger
const logger_1 = require("@hubspot/cli-lib/logger");
const relevantModules = {};
function getRelevantModules(output) {
    return relevantModules[output] || [];
}
exports.getRelevantModules = getRelevantModules;
const relevantModulesPlugin = ({ output }) => {
    return {
        name: 'ui-extensions-relevant-modules-plugin',
        generateBundle(_options, bundle) {
            const subBundle = bundle[output];
            if (!subBundle || !subBundle.moduleIds) {
                // If this happens, something has gone horribly wrong
                logger_1.logger.error('Invalid bundle format, please try saving the extension again.  If the problem persists try restarting `hs project dev`');
                return;
            }
            const updatedRelevantModules = subBundle.moduleIds.filter(moduleId => !(0, utils_1.isNodeModule)(moduleId));
            if (updatedRelevantModules.length === 0) {
                logger_1.logger.error('Unable to determine relevant files to watch, please try saving the extension again. If the problem persists try restarting `hs project dev`');
                return;
            }
            relevantModules[output] = updatedRelevantModules;
        },
    };
};
exports.default = relevantModulesPlugin;
