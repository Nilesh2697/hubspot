"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = __importDefault(require("fs"));
// @ts-expect-error no type defs for the logger
const logger_1 = require("@hubspot/cli-lib/logger");
const codeCheckingPlugin = options => {
    const { output } = options;
    return {
        name: 'ui-extensions-code-checking-plugin',
        enforce: 'post',
        writeBundle(__options, __bundle) {
            try {
                const code = fs_1.default.readFileSync(output).toString();
                if (!code.includes('const extend = (...args) => self.extend(...args);') &&
                    !code.includes('self.extend_V2(renderExtensionCallback)')) {
                    logger_1.logger.warn('Unable to determine if your extension entry point is calling hubspot.extend, this may prevent it from rendering as expected');
                }
            }
            catch (e) {
                logger_1.logger.error('Unable to load bundle for code checking');
            }
        },
    };
};
exports.default = codeCheckingPlugin;
